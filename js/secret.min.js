(function(){
	var timer;
	var emojis = ['😀','😬','😂','😄','😅','😇','☺️','😋','😘','😚','😜','🤑','😎','🤗','😳','🙄','😤','😱','😨','😰','😥','🤒','😭','💩','👹','💀','👻','👽','🤖','😺','😹','😻','😼','😽','🙀','😿','😾','🙌','👏','👋','👍','👊','✊','✌️','👌','✋','👐','💪','☝️','🙏','👆','🖐','🤘','🖖','✍️','💅','👄','👅','👂','👁','👀','👶','👦','👧','👨','👩','👱','👴','👵','👲','👳','👷','💂','🕵','🎅','👼','👸','👰','🚶','🏃','💃','👯','👫','👬','👭','🙇','💁','🙅','🙆','🙋','🙎','🙍','💇','💆','💑','👨‍❤️‍👨','💏','👩‍❤️‍💋‍👩','👨‍❤️‍💋‍👨','👩‍👩‍👦','👨‍👨‍👦','👮','👚','👕','👖','👔','👗','👙','👘','💄','💋','🎩','👟','👞','👢','👡','📱','👠','👣','⛑','🎓','👑','🎒','👝','👛','👜','💼','🌂','💍','🕶','👓','🐯','🦁','🐮','🐷','🐽','🐸','🐙','🐵','🐦','🐧','🐔','🐒','🙉','🙈','🐣','🐥','🐺','🐗','🐴','🦄','🐝','🐛','🐢','🦀','🦂','🕷','🐜','🐞','🐌','🐠','🐟','🐡','🐬','🐋','🐊','🐆','🐘','🐫','🐪','🐄','🐂','🐃','🐏','🐑','🐀','🐁','🐓','🦃','🐉','🐾','🐿','🐇','🐈','🐩','🐕','🐲','🌵','🎄','🌲','🌴','🌱','🌿','🌾','🍁','🍂','🍃','🎋','🎍','🍀','🌺','🌻','🌹','🌷','🌼','🌸','💐','🍄','🎃','🐚','🌎','🌍','🌏','🌕','🌖','🌗','🌘','🌑','🌒','🌓','🌔','🌚','🌝','🌛','🌜','🌞','⭐️','🌟','💫','✨','☄️','🌥','🌦','🌧','⛈','⚡️','🔥','❄️','🌨','☔️','☂️','🌪','💨','☃️','⛄️','💧','💦','🌊','🍏','🍎','🍐','🍋','🍌','🍉','🍇','🌶','🍅','🍍','🍑','🍈','🍓','🌽','🍠','🍯','🍞','🍗','🧀','🍖','🍤','🌯','🌮','🍝','🍕','🌭','🍟','🍔','🍳','🍜','🍲','🍥','🍣','🍱','🍛','🍙','🍚','🎂','🍰','🍦','🍨','🍧','🍡','🍢','🍘','🍮','🍬','🍭','🍫','🍿','🍩','🍪','🍺','☕️','🍵','🍶','🍹','🍻','🍼','🍴','🍷','🍽','⚽️','🏀','🏈','⚾️','🎾','🏐','🏉','🎱','🎿','🏏','🏑','🏓','🏌','⛳️','⛷','🏂','⛸','🏹','🎣','🚣','🏊🏼','🏄','🏆','🕴','🏇','🚵','🚴','🏋','⛹','🛀','🎽','🏅','🎖','🎗','🏵','🎫','🎟','🎭','🎺','🎷','🎹','🎤','🎪','🎨','🎸','🎻','🎬','🎮','👾','🎯','🎲','🎰','🎳','🚗','🚕','🚙','🚌','🚎','🏎','🚓','🚒','🚐','🚛','🚜','🏍','🚲','🚨','🚃','🚟','🚠','🚡','🚖','🚘','🚍','🚔','🚋','🚝','🚄','🚅','🚈','🚞','🚂','🚆','🛬','🛫','✈️','🛩','🚁','🚉','🚊','🚇','⛵️','🛥','🚤','⛴','🚀','🛳','🛰','💺','🏁','🚥','🚦','🚏','⛽️','🚧','⚓️','🎡','🎢','🎠','🏗','🌁','🗼','🏭','⛲️','⛺️','🏕','🗾','🌋','🗻','🏔','⛰','🎑','🏞','🛣','🛤','🌅','🌄','🏜','🏖','🏝','🎇','🌠','🌌','🌉','🌃','🏙','🌆','🌇','🎆','🌈','🏘','🏰','🏯','🏠','🗽','🏟','🏡','🏚','🏢','🏬','🏣','🏤','🏥','🏦','🕌','⛪️','🏛','💒','🏩','🏫','🏪','🏨','🕍','🕋','⛩','🕹','💽','💾','💿','📼','📷','📹','🎥','☎️','⏱','🎙','📻','📺','📠','📟','⏲','⏰','🕰','⏳','📡','🔋','💴','💵','💸','🛢','🔦','💡','💶','💷','💰','💳','💎','🔨','💣','🔫','🔪','☠️','🔮','💈','💊','💉','🔖','🚿','🔑','🛋','🚪','🛎','🖼','🎁','🎀','🎏','🎈','🛍','⛱','🗺','🎊','🎉','🎎','🎐','🎌','🏮','📮','📫','📯','📊','🗃','📇','📅','📉','📈','📰','📕','📙','📒','✂️','🖇','📖','📚','📌','📍','🚩','❤️','💔','❣️','💕','💓','💗','💖','💘','💝','💠','🔔'];
	var allElements = document.querySelectorAll('*');
	var textElements = document.querySelectorAll('a, span, p, h3');
	var mostElements = document.querySelectorAll('select, input, label');
	var scoreElem;
	var hasJakeWeary = window.jQuery;
	var score = 0;

	var body = document.body, html = document.documentElement;
	var height = Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight);
	var width = Math.max(body.scrollWidth, body.offsetWidth, html.clientWidth, html.scrollWidth, html.offsetWidth);
	var docHeight = html.clientHeight;
	var docWidth = html.clientWidth;


	function show_rick() {
		var image = document.createElement("img");
		image.className = "rick";
		image.src = "http://i.imgur.com/3AP2hdu.png";
		var imgWidth = 290;
		var imgHeight = 300;
		var side = Math.floor(Math.random() * 4); //0-3, starting at bottom and going CCW
		var pos;
		image.style.height = imgHeight+"px";
		image.style.width = imgWidth+"px";
		var off = Math.random()*20;
		if (Math.random()*2 >= 0.5) {
			off = -off-20;
		}
		image.style.transform = "rotateZ("+((side*90)+off)+"deg)";
		body.appendChild(image);
		var order = 1;

		var completionBlock = function() {
			body.removeChild(image);
		};

		var duration = 800, easing = "linear", max = 110;

		function veloc(side) {
			image.style[side] = "-500px";
			var options = {};
			options[side] = [-max, -imgHeight];
			do_velocity(image, options, {
				easing: easing,
				duration: duration,
				complete: function() {
					options[side] = [-imgHeight, -max];
					do_velocity(image, options, {
						easing: easing,
						duration: duration,
						complete: completionBlock
					}, true);
				}
			});
		}

		if (side == 0) { // bottom
			image.style.left = (Math.random()*(docWidth-imgWidth))+"px";
			veloc("bottom");
		} else if (side == 1) { // left
			image.style.top = (Math.random()*(docHeight-imgHeight))+"px";
			veloc("left");
		} else if (side == 2) { // top
			image.style.left = (Math.random()*(docWidth-imgWidth))+"px";
			veloc("top");
		} else if (side == 3) { // right
			image.style.top = (Math.random()*(docHeight-imgHeight))+"px";
			veloc("right");
		}
	}


	var emojiTimer, emojiDropTimer;
	function gen_emoji(count) {
		if (count == 0) {
			return "";
		}
		return emojis[Math.floor(Math.random()*emojis.length)] + gen_emoji(count-1);
	}
	function emojify(num) {
		if (num >= textElements.length) {
			clearTimeout(emojiTimer);
			return;
		} else {
			var element = textElements[num];
			var emo = gen_emoji(Math.floor(Math.random()*10)+2);
			if (element.value) {
				element.value = emo;
			} else {
				element.innerText = emo;
			}
			schedule_function(function() {
				emojify(num+1);
			}, 1000, true);
		}
	}

	var scheduleTimeStart, scheduleTimer, scheduleTimeElapsed;
	var schedule = {};
	function start_scheduler() {
		scheduleTimeElapsed = 0;
		scheduleTimeStart = new Date().getTime();
		scheduleTimer = setTimeout(schedule_tick, 100);
	}

	function stop_scheduler() {
		clearTimeout(scheduleTimer);
		scheduleTimer = null;
		scheduleTime = 0;
		scheduleTimeElapsed = 0;
	}

	function schedule_tick() {
		if (!scheduleTimer) {
			return;
		}

		scheduleTimeElapsed += 100;

		if (schedule[scheduleTimeElapsed]) {
			while (schedule[scheduleTimeElapsed].length > 0) {
				(schedule[scheduleTimeElapsed].pop())();
			}
		}

		var diff = new Date().getTime() - scheduleTimeStart;
		diff -= scheduleTimeElapsed;
		scheduleTimer = setTimeout(schedule_tick, (100 - diff));
	}

	//Schedule a function after a specified time period. Time must be
	//a multiple of 100
	function schedule_function(func, time, isTimeOffset) {
		if (time % 100 != 0) {
			return;
		}
		if (isTimeOffset) {
			time += scheduleTimeElapsed;
		}

		if (schedule[time]) {
			schedule[time].push(func);
		} else {
			schedule[time] = [func];
		}
	}

	function do_velocity(element, animation, options, shouldReverse) {
		if (hasJakeWeary) {
			$(element).velocity(animation, options);
			if (shouldReverse) {
				$(element).velocity("reverse");
			}
		} else {
			Velocity(element, animation, options);
			if (shouldReverse) {
				Velocity(element, "reverse");
			}
		}
	}

	function do_velocity_stop(element) {
		if (hasJakeWeary) {
			$(element).velocity("stop");
		} else {
			Velocity(element, "stop");
		}
	}

	function drop_emoji(char) {
		var emoji = document.createElement("emoji");
		emoji.innerText = char;
		emoji.className = "emoji-item";
		emoji.style.fontSize = (Math.floor(Math.random()*70)+20)+"px";
		emoji.style.top = "-100px";
		emoji.style.left = (Math.random()*(docWidth*0.7)+(docWidth*0.15))+"px";
		emoji.style.position = "absolute";
		emoji.style.zIndex = "999";
		emoji.style.transform = "rotateZ("+((Math.random()*30)-15)+"deg)";
		emoji.style.cursor = "pointer";
		emoji.addEventListener("mouseover", function(event) {
			var moji = event.target;
			if (!moji.clicked) {
				do_velocity(moji, {
					scale: 0,
					rotateZ: "359deg"
				}, {
					easing: "linear",
					duration: 250,
					queue: false,
					complete: function() {
						do_velocity_stop(moji);
						body.removeChild(emoji);
					}
				});
				game_inc_score(1);
				moji.clicked = true;
			}
		});
		body.appendChild(emoji);

		var speed = Math.floor((Math.random()*8000)+4000);
		do_velocity(emoji, {top: (docHeight)+"px"}, {
			easing: "linear",
			duration: speed,
			complete: function() {
				if (emoji.clicked !== true) {
					var left = parseInt(emoji.style.left);
					if (left >= 5 && left <= docWidth - 10 ) {
						game_lost();
					}
				}
				body.removeChild(emoji);
			}
		});
		var left = Math.floor(Math.random()*200);
		emoji_animation(emoji, left, speed/2);
	}
	function emoji_animation(element, offset, speed) {
		var str = "";
		if (offset % 2 == 0) {
			str = "+";
		} else {
			str = "-";
		}
		str += "="+offset+"px";
		do_velocity(element, {
			left: str
		}, {
			queue: false,
			complete: function() {
				emoji_animation(element, offset+1, speed);
			},
			duration: speed
		});
	}

	var volume;
	function mute_pressed(event) {
		var element = event.target;
		var activeClassName = "audio-mute-active";
		if (audio.volume === 0) {
			element.classList.remove(activeClassName);
			audio.volume = volume;
		} else {
			element.classList.add(activeClassName);
			audio.volume = 0;
		}
	}

	var mute = document.createElement("div");
	mute.id = "audio-mute";
	mute.addEventListener("click", mute_pressed);
	body.appendChild(mute);

	var close = document.createElement("div");
	close.id = "close-me";
	close.addEventListener("click", end_sequence);
	body.appendChild(close);

	var hanger = document.createElement("div");
	hanger.id = "hanger";
	var ball = document.createElement("div");
	ball.id = "discoball";
	var img = document.createElement("img");
	img.id = "discoball-img";
	//"http://i1101.photobucket.com/albums/g425/zzzestycabbage/disco_ball_2.png";
	img.src = eval(function(p,a,c,k,e,d){e=function(c){return c};if(!''.replace(/^/,String)){while(c--){d[c]=k[c]||c}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('"2://1.0.3/4/7/6/5.8"',9,9,'photobucket|i1101|http|com|albums|disco_ball_2|zzzestycabbage|g425|png'.split('|'),0,{}));
	ball.appendChild(img);
	body.appendChild(hanger);
	body.appendChild(ball);
	play_song();
	var audio;
	function play_song() {
		//"https://ia800805.us.archive.org/27/items/NeverGonnaGiveYouUp/jocofullinterview41.mp3"
		var audioURL = eval(function(p,a,c,k,e,d){e=function(c){return c};if(!''.replace(/^/,String)){while(c--){d[c]=k[c]||c}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('"3://2.1.0.4/5/8/7/6.9"',10,10,'archive|us|ia800805|https|org|27|jocofullinterview41|NeverGonnaGiveYouUp|items|mp3'.split('|'),0,{}));
		audio = new Audio(audioURL);
		audio.volume = 0.5;
		volume = audio.volume;
		audio.load();
		audio.addEventListener("canplaythrough", function() {
			document.title = "👻🇨🇿👻";
			body.style.webkitUserSelect = "none";
			audio.play();
			start_sequence();
		});
		audio.addEventListener("ended", function() {
			end_sequence();
		});
	}
	var lyricTimer;
	var seq = ["never", "gonna", "give", "you", "👆", "never", "gonna", "let", "you", "👇"];
	var select = ["tell a lie", "say goodbye", "turn around and desert you"];
	function set_options() {
		var str = "";
		var server = document.getElementById("server");
		for (var i in select) {
			str += "<option>"+select[i]+"</option>";
		}
		server.innerHTML = str;
	}
	function add_input(num) {
		if (num >= seq.length) {
			clearTimeout(lyricTimer);
			return;
		}
		add_exclusion(seq[num]);
		add_extension(seq[num]);
		mostElements = document.querySelectorAll('select, input, label');
		schedule_function(function() {
			add_input(num+1);
		}, 1000, true);
	}
	function rick_time(arr, spacing) {
		for (var i in arr) {
			schedule_function(show_rick, arr[i], false);
		}
	}
	function start_sequence() {
		start_scheduler();
		var filetreeSec = document.getElementById("section-filetree");
		do_velocity(filetreeSec, {height: "0px"}, {
			easing: "easeOutBounce",
			duration: 1000,
			complete: function() {
				filetreeSec.parentElement.removeChild(filetreeSec);
			}
		});
		schedule_function(function() {
			clear_inputs("exclusion-container");
			clear_inputs("extension-container");
			set_options();
			add_input(0);
			schedule_function(disco, 1000, true);
		}, 2000);
		/*var div1 = document.createElement("div");
		div1.style.position = "absolute";
		div1.style.left = "200px";
		div1.style.top = "100px";
		div1.style.color = "white";
		div1.style.backgroundColor = "black";
		div1.style.zIndex = 6000;
		div1.addEventListener("click", function() {
			console.log(scheduleTimeElapsed);
		});
		body.appendChild(div1);
		var time = 0;
		var func = function() {
			schedule_function(function() {
				div1.innerText = (time+=200);
				func();
			}, 200, true);
		}
		func();*/
		rick_time([
			43800, 46000, 48000, 52300, 54500, 56500, 86100, 88100, 90100,
			94500, 96400, 98700, 103800, 105000, 107100, 111300, 113400, 115500,
			129900, 130700, 131100, 131500, 133200, 134900, 135300, 135700,
			161900, 163900, 166000, 170200, 172400, 174500, 178600, 180700,
			182800, 187100, 189100, 191200, 197400, 198100, 199600], 1000);
		do_velocity(hanger, {
			top: 0
		}, {
			easing: "linear",
			duration: 1500,
			delay: 0,
			queue: false
		});
		do_velocity(ball, {
			top: 60
		}, {
			easing: "linear",
			duration: 1500,
			delay: 0,
			queue: false
		});
		schedule_function(sequence_body, 19500);
		schedule_function(function() {
			emojify(0);
			var drop = function() {
				drop_emoji(gen_emoji(1));
				schedule_function(function() {
					drop();
				}, 1000, true);
			}
			drop();
		}, 1000);
	}
	function sequence_body() {
		wiggle(true, 0);
		schedule_function(function() {
			wiggle(false);
			wiggle(true, 1);
		}, 16500, true);
		schedule_function(function() {
			wiggle(false);
			wiggle(true, 2);
		}, 24500, true);
		schedule_function(function() {
			wiggle(false);
			sequence_body();
		}, 34500, true);
	}
	function end_sequence() {
		stop_scheduler();
		do_velocity_stop(body);
		window.location.reload();
	}
	function gen_color() {
		return '#'+Math.floor(Math.random()*256).toString(16)+Math.floor(Math.random()*256).toString(16)+Math.floor(Math.random()*256).toString(16)
	}
	function random_background() {
		var color = gen_color();
		do_velocity(body, { backgroundColor: color }, {
			easing: "linear",
			duration: 500
		});
	}
	function disco() {
		random_background();
		for (var i = allElements.length - 1; i >= 0; i--) {
			allElements[i].style.color = gen_color();
		};
		schedule_function(disco, 1000, true);
	}
	function wiggle(startOrFalse, num) {
		if (!startOrFalse) {
			for (var i = mostElements.length - 1; i >= 0; i--) {
				mostElements[i].classList.remove("wiggle-l");
				mostElements[i].classList.remove("wiggle-r");
				mostElements[i].classList.remove("wiggle-u");
				mostElements[i].classList.remove("wiggle-d");
				mostElements[i].classList.remove("wiggle-cw");
				mostElements[i].classList.remove("wiggle-ccw");
			}
			return;
		}
		function decide_wiggle(num, type) {
			var className = "";
			switch (type) {
				case 0:
					className = (num%2==0?"wiggle-l":"wiggle-r");
					break;
				case 1:
					className = (num%2==0?"wiggle-u":"wiggle-d");
					break;
				case 2:
					className = (num%2==0?"wiggle-cw":"wiggle-ccw");
					break;
				default:

			}
			return className;
		}
		for (var i = mostElements.length - 1; i >= 0; i--) {
			mostElements[i].classList.add(decide_wiggle(i, num));
		}
	}
	function game_lost() {
		score = 0;
		if (scoreShown) {
			score_update();
		}
	}
	var scoreShown = false;
	function game_inc_score(amount) {
		if (!scoreShown) {
			scoreElem = document.createElement("div");
			scoreElem.className = "game-score";
			scoreElem.innerText = "0";
			body.appendChild(scoreElem);
			scoreShown = true;
		}
		score += amount;
		score_update();
	}
	function score_update() {
		scoreElem.innerText = score;
	}
})();
